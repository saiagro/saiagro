package com.erudex.akshara.controller;

import java.io.IOException;
import java.io.PrintWriter;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.propertyeditors.CustomDateEditor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.WebDataBinder;
import org.springframework.web.bind.annotation.InitBinder;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import com.erudex.akshara.bean.AccountTypeBean;
import com.erudex.akshara.bean.AccountsBean;
import com.erudex.akshara.bean.CatagoryBean;
import com.erudex.akshara.bean.DistrictBean;
import com.erudex.akshara.bean.EmailBean;
import com.erudex.akshara.bean.PackingBean;
import com.erudex.akshara.bean.PhoneBean;
import com.erudex.akshara.bean.ProductBean;
import com.erudex.akshara.bean.RouteCodeBean;
import com.erudex.akshara.bean.StateBean;
import com.erudex.akshara.bean.TechnicalNameBean;
import com.erudex.akshara.model.AccountPhone;
import com.erudex.akshara.model.AccountType;
import com.erudex.akshara.model.Accounts;
import com.erudex.akshara.model.Catagory;
import com.erudex.akshara.model.District;
import com.erudex.akshara.model.Packing;
import com.erudex.akshara.model.Phone;
import com.erudex.akshara.model.Product;
import com.erudex.akshara.model.RouteCode;
import com.erudex.akshara.model.State;
import com.erudex.akshara.model.TechnicalName;
import com.erudex.akshara.service.AccountPhoneService;
import com.erudex.akshara.service.AccountTypeService;
import com.erudex.akshara.service.AccountsService;
import com.erudex.akshara.service.CatagoryService;
import com.erudex.akshara.service.DistrictService;
import com.erudex.akshara.service.PackingService;
import com.erudex.akshara.service.PhoneService;
import com.erudex.akshara.service.ProductService;
import com.erudex.akshara.service.RouteCodeService;
import com.erudex.akshara.service.StateService;
import com.erudex.akshara.service.TechnicalNameService;
import com.google.gson.Gson;

@Controller
public class TenderController {

	@Autowired
	private ProductService productService;
	
	@Autowired
	private PackingService packingService;
	
	@Autowired
	private TechnicalNameService technicalNameService;
	
	@Autowired
	private CatagoryService catagoryService;
	
	@Autowired
	private AccountTypeService accountTypeService;
	
	@Autowired
	private DistrictService districtService;
	
	@Autowired
	private StateService stateService;
	
	@Autowired
	private RouteCodeService routeCodeService;
	
	@Autowired
	private AccountsService accountsService;
	
	@Autowired
	private PhoneService phoneService;
	
	@Autowired
	private AccountPhoneService accountPhoneService;
	
	
	@InitBinder
	protected void initBinder(WebDataBinder binder) {
	    SimpleDateFormat dateFormat = new SimpleDateFormat("dd-MM-yyyy");
	    binder.registerCustomEditor(Date.class, new CustomDateEditor(
	            dateFormat, false));
	}
	
	@RequestMapping(value = "/accounts", method = RequestMethod.GET)
	public ModelAndView accounts(@ModelAttribute("accounts") AccountsBean accountsBean,BindingResult result) {
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("accountTypeList", prepareAccountTypeList(accountTypeService.listAccountTypes()));
		model.put("stateList", prepareStateBeanListL(stateService.listStates()));
		model.put("routeCodeList", PrepareRouteCodeBeanList(routeCodeService.listRouteCodes()));
		model.put("accounts", new Accounts());
		return new ModelAndView("accounts",model);
	}

	@RequestMapping(value = "/saveAccounts", method = RequestMethod.POST)
	public ModelAndView saveAccounts(@ModelAttribute("accounts") AccountsBean accountsBean,
			PhoneBean phoneBean,EmailBean email,BindingResult result,Model model) {

		Accounts account=prepareAccount(accountsBean);
		accountsService.addAccount(account);
		accountPhoneService.deleteAccount(accountsBean.getAccount_id());
		String phone_no[]=phoneBean.getPhone_no().split(",");
		String phone_type[]=phoneBean.getPhone_type().split(",");
		System.out.println("length of phone: "+phone_no.length);
		for(int i=0;i<phone_no.length;i++)
		{
			System.out.println("phone_no: "+phone_no[i]);
			System.out.println("Phone Type: "+phone_type[i]);
			phoneBean.setPhone_no(phone_no[i]);
			phoneBean.setPhone_type(phone_type[i]);
			Phone phone=preparePhone(phoneBean);
			phoneService.addPhone(phone);
			
			AccountPhone accountPhone=new AccountPhone();
			accountPhone.setAccount_id(accountsBean.getAccount_id());
			accountPhone.setPhone_id(phone.getPhone_id());
            accountPhoneService.addAccountPhone(accountPhone);			
			
		}
		return new ModelAndView("redirect:accounts.html");
	}
	
	private Phone preparePhone(PhoneBean phoneBean) {
		Phone phone=new Phone();
		phone.setPhone_id(Integer.parseInt(phoneBean.getPhone_id()));
		phone.setPhone_no(Integer.parseInt(phoneBean.getPhone_no()));
		phone.setPhone_type(phoneBean.getPhone_type());
		return phone;
	}

	@RequestMapping(value = "/accountsList", method = RequestMethod.POST)
	public ModelAndView accountsList(@ModelAttribute("accounts") AccountsBean accountsBean,BindingResult result) {
		Map<String, Object> model = new HashMap<String, Object>();
		/*model.put("accountTypeList", prepareAccountTypeList(accountTypeService.listAccountTypes()));
		model.put("stateList", prepareStateBeanListL(stateService.listStates()));
		model.put("routeCodeList", PrepareRouteCodeBeanList(routeCodeService.listRouteCodes()));
		Accounts account=prepareAccount(accountsBean);
		accountsService.addAccount(account);*/
		model.put("accountsList", prepareAccountsBeanList(accountsService.listAccounts()));
		return new ModelAndView("accountsList",model);
	}
	
	@RequestMapping(value = "/deleteAccount", method = RequestMethod.POST)
	public ModelAndView deleteAccount(@ModelAttribute("accounts") AccountsBean accountsBean,BindingResult result) {
		Map<String, Object> model = new HashMap<String, Object>();
		accountsService.deleteAccount(accountsBean.getAccount_id());
		model.put("accountsList", prepareAccountsBeanList(accountsService.listAccounts()));
		return new ModelAndView("accountsList",model);
	}
	
	@RequestMapping(value = "/editAccount", method = RequestMethod.POST)
	public ModelAndView editAccounts(@ModelAttribute("accounts") AccountsBean accountsBean,BindingResult result,Model model) {
		AccountsBean accounts=prepareAccountsBean(accountsService.getAccount(accountsBean.getAccount_id()));
		List<DistrictBean> districtsListBean=prepareDistrictListBean(districtService.listDistricts(accounts.getState_id()));
		Map<Integer,String> districtList = new LinkedHashMap<Integer,String>();
		for(DistrictBean districtBean:districtsListBean)
		{
			districtList.put(districtBean.getDistrict_id(), districtBean.getDistrict_name());
		}
		//List<PhoneBean> phoneList=preparePhoneList(accountPhoneService.listAccountPhones());
//		model.addAttribute("phoneList", phoneList);
		List<PhoneBean> phoneList=preparePhoneBeanList(phoneService.listPhones());
		model.addAttribute("phoneList", phoneList);
		model.addAttribute("accountTypeList", prepareAccountTypeList(accountTypeService.listAccountTypes()));
		model.addAttribute("stateList", prepareStateBeanListL(stateService.listStates()));
		model.addAttribute("routeCodeList", PrepareRouteCodeBeanList(routeCodeService.listRouteCodes()));
		model.addAttribute("districtList", districtList);
		model.addAttribute("accounts", accounts);
		return new ModelAndView("accounts");
	}
	
   private List<PhoneBean> preparePhoneBeanList(List<Phone> listPhones) {
	    List<PhoneBean> phoneBeanList=new ArrayList<PhoneBean>();
	    if(listPhones !=null && !listPhones.isEmpty())
	    {
	    for(Phone phone:listPhones)
	    {
	    	PhoneBean phoneBean=new PhoneBean();
	    	phoneBean.setPhone_no(Integer.toString(phone.getPhone_no()));
	    	phoneBean.setPhone_type(phoneBean.getPhone_type());
	    	phoneBeanList.add(phoneBean);
	    }
	    }
		return phoneBeanList;
	}

private List<PhoneBean> preparePhoneList(List<AccountPhone> listAccountPhones) {
	    List<PhoneBean> phoneBeanList=new ArrayList<PhoneBean>();
	    for(AccountPhone accountPhone:listAccountPhones)
	    {
	    	PhoneBean bean=preparePhoneBean(phoneService.getPhone(accountPhone.getPhone_id()));
	    	phoneBeanList.add(bean);
	    }
		return null;
	}

   private PhoneBean preparePhoneBean(Phone phone) {
	   PhoneBean phoneBean=new PhoneBean();
	   phoneBean.setPhone_id(Integer.toString(phone.getPhone_id()));
	   phoneBean.setPhone_type(phone.getPhone_type());
	   phoneBean.setPhone_no(Integer.toString(phone.getPhone_no()));
   	   return phoneBean;
    }

   private AccountsBean prepareAccountsBean(Accounts account) {
	   AccountsBean bean=new AccountsBean();
   	   bean.setAccount_id(account.getAccount_id());
   	   System.out.println("account name:"+account.getAccount_name());
   	   bean.setAccount_name(account.getAccount_name());
   	   bean.setAccount_type_id(account.getAccount_type_id());
   	   bean.setContact_person(account.getContact_person());
       bean.setHouse_no(account.getHouse_no());
   	   bean.setStreet_name(account.getStreet_name());
   	   bean.setArea(account.getArea());
   	   bean.setState_id(account.getState_id());
   	   bean.setDistrict_id(account.getDistrict_id());
   	   bean.setPin_code(account.getPin_code());
   	   bean.setRoute_code_id(account.getRoute_code_id());
   	   bean.setApgst_no(account.getApgst_no());
   	   bean.setCst_no(account.getCst_no());
   	   bean.setPan_no(account.getPan_no());
   	   bean.setVat_no(account.getVat_no());
   	   bean.setTin_no(account.getTin_no());
   	   bean.setPl_no(account.getPl_no());
   	   bean.setCredit_limit(account.getCredit_limit());
   	   bean.setCredit_days(account.getCredit_days());
	   return bean;
	}

    private Object prepareAccountsBeanList(List<Accounts> listAccounts) {
	    List<AccountsBean> beans=new ArrayList<AccountsBean>();
	    for(Accounts account:listAccounts)
	    {
	    	AccountsBean bean=new AccountsBean();
	    	bean.setAccount_id(account.getAccount_id());
	    	bean.setAccount_name(account.getAccount_name());
	    	bean.setAccount_type_id(account.getAccount_type_id());
	    	bean.setContact_person(account.getContact_person());
	    	bean.setHouse_no(account.getHouse_no());
	    	bean.setStreet_name(account.getStreet_name());
	    	bean.setArea(account.getArea());
	    	bean.setState_id(account.getState_id());
	    	bean.setDistrict_id(account.getDistrict_id());
	    	bean.setPin_code(account.getPin_code());
	    	bean.setRoute_code_id(account.getRoute_code_id());
	    	bean.setApgst_no(account.getApgst_no());
	    	bean.setCst_no(account.getCst_no());
	    	bean.setPan_no(account.getPan_no());
	    	bean.setVat_no(account.getVat_no());
	    	bean.setTin_no(account.getTin_no());
	    	bean.setPl_no(account.getPl_no());
	    	bean.setCredit_limit(account.getCredit_limit());
	    	bean.setCredit_days(account.getCredit_days());
	    	beans.add(bean);
	    }
		return beans;
	}

   private Accounts prepareAccount(AccountsBean accountsBean) {
	    Accounts account=new Accounts();
	    account.setAccount_id(accountsBean.getAccount_id());
	    account.setAccount_name(accountsBean.getAccount_name());
	    account.setAccount_type_id(accountsBean.getAccount_type_id());
	    account.setContact_person(accountsBean.getContact_person());
	    account.setHouse_no(accountsBean.getHouse_no());
	    account.setStreet_name(accountsBean.getStreet_name());
	    account.setArea(accountsBean.getArea());
	    account.setState_id(accountsBean.getState_id());
	    account.setDistrict_id(accountsBean.getDistrict_id());
	    account.setPin_code(accountsBean.getPin_code());
	    account.setRoute_code_id(accountsBean.getRoute_code_id());
	    account.setApgst_no(accountsBean.getApgst_no());
	    account.setCst_no(accountsBean.getCst_no());
	    account.setPan_no(accountsBean.getPan_no());
	    account.setVat_no(accountsBean.getVat_no());
	    account.setTin_no(accountsBean.getTin_no());
	    account.setPl_no(accountsBean.getPl_no());
	    account.setCredit_limit(accountsBean.getCredit_limit());
	    account.setCredit_days(accountsBean.getCredit_days());
		return account;
	}

     private Object PrepareRouteCodeBeanList(List<RouteCode> listRouteCodes) {
	    Map<Integer,String> routeCodeList = new LinkedHashMap<Integer,String>();
		for(RouteCode routeCode:listRouteCodes)
		{
			routeCodeList.put(routeCode.getRoute_code_id(), routeCode.getRoute_code_name());
		}
		return routeCodeList;
	}

	private Object prepareAccountTypeList(List<AccountType> listAccountTypes) {
		Map<Integer,String> accountTypeList = new LinkedHashMap<Integer,String>();
		for(AccountType accountType:listAccountTypes)
		{
			accountTypeList.put(accountType.getAccount_type_id(), accountType.getAccount_type_name());
		}
		return accountTypeList;
	}

	@RequestMapping(value = "/journalVouchersEntry", method = RequestMethod.GET)
	public ModelAndView journalVoucher() {
		return new ModelAndView("journalVouchersEntry");
	}
	
	@RequestMapping(value = "/productOpeningStockEntry", method = RequestMethod.GET)
	public ModelAndView productOpeningStockEntry() {
		return new ModelAndView("productOpeningStockEntry");
	}
	
	@RequestMapping(value = "/packing", method = RequestMethod.GET)
	public ModelAndView packing(@ModelAttribute("packing") PackingBean packingBean,BindingResult result) {
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("product", new Packing());
		return new ModelAndView("packing",model);
	}
	
	@RequestMapping(value = "/savePacking", method = RequestMethod.POST)
	public ModelAndView savePacking(@ModelAttribute("packing") PackingBean packingBean,BindingResult result) {
//		Map<String, Object> model = new HashMap<String, Object>();
		Packing packing=prepareModel(packingBean);
		packingService.addPacking(packing);
//		model.put("packing", null);
		return new ModelAndView("redirect:packing.html");
	}
	
	@RequestMapping(value = "/editPacking", method = RequestMethod.POST)
	public ModelAndView editPacking(@ModelAttribute("packing") PackingBean packingBean,BindingResult result) {
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("packing", preparePackingBean(packingService.getPacking(packingBean.getPacking_id())));
		return new ModelAndView("packing",model);
	}
	
	@RequestMapping(value = "/deletePacking", method = RequestMethod.POST)
	public ModelAndView deletePacking(@ModelAttribute("packing") PackingBean packingBean,BindingResult result) {
		Map<String, Object> model = new HashMap<String, Object>();
		packingService.deletePacking(packingBean.getPacking_id());
		model.put("packingList", preparePackingBeanList(packingService.listPacking()));
		return new ModelAndView("packingList",model);
	}
	
	@RequestMapping(value = "/packingList", method = RequestMethod.POST)
	public ModelAndView listPacking(@ModelAttribute("packing") PackingBean packingBean,BindingResult result) {
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("packingList", preparePackingBeanList(packingService.listPacking()));
		return new ModelAndView("packingList",model);
	}
	
	private Packing prepareModel(PackingBean packingBean) {
		Packing packing=new Packing();
	    packing.setPacking_id(packingBean.getPacking_id());  
	    packing.setPacking_name(packingBean.getPacking_name());
		return packing;
	}
	
	private PackingBean preparePackingBean(Packing packing) {
        PackingBean packingBean=new PackingBean();
        packingBean.setPacking_id(packing.getPacking_id());
        packingBean.setPacking_name(packing.getPacking_name());
		return packingBean;
	}
	
	private Object preparePackingBeanList(List<Packing> listPacking) {
		List<PackingBean> packingBeanList=new ArrayList<PackingBean>();	
		for(Packing packing:listPacking)
		{
			PackingBean packingBean=new PackingBean();
			packingBean.setPacking_id(packing.getPacking_id());
			packingBean.setPacking_name(packing.getPacking_name());
			packingBeanList.add(packingBean);
		}
		return packingBeanList;
	}


	@RequestMapping(value="/productInformationMaster", method= RequestMethod.GET)
	public ModelAndView productInformationMaster(){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("product", new Product());
		model.put("packingList", preparePackingList(packingService.listPacking()));
		model.put("technicalList", prepareTechnicalList(technicalNameService.listTechnicalNames()));
		model.put("catagoryList", prepareCatagoryList(catagoryService.listCatagory()));
		return new ModelAndView("productInformationMaster",model);
	}
	
	@RequestMapping(value="/technical", method= RequestMethod.GET)
	public ModelAndView technical(@ModelAttribute("productInformation") TechnicalNameBean technicalNameBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("technical", new TechnicalName());
//		model.put("technicalList", prepareListTechnical(technicalNameService.listTechnicalNames()));
		return new ModelAndView("technical",model);
	}
	
	@RequestMapping(value="/saveTechnical", method= RequestMethod.POST)
	public ModelAndView saveTechnical(@ModelAttribute("productInformation") TechnicalNameBean technicalNameBean){
//		Map<String, Object> model = new HashMap<String, Object>();
		TechnicalName technicalName=prepareTechnicalName(technicalNameBean);
		technicalNameService.addTechnicalName(technicalName);
//		model.put("technical", new TechnicalName());
//		model.put("technicalList", prepareListTechnical(technicalNameService.listTechnicalNames()));
		return new ModelAndView("redirect:technical.html");
	}
	
	@RequestMapping(value="/technicalList", method= RequestMethod.POST)
	public ModelAndView technicalList(@ModelAttribute("productInformation") TechnicalNameBean technicalNameBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("technical", new TechnicalName());
		model.put("technicalList", prepareListTechnical(technicalNameService.listTechnicalNames()));
		return new ModelAndView("technicalList",model);
	}
	
	@RequestMapping(value="/editTechnical", method= RequestMethod.POST)
	public ModelAndView editTechnical(@ModelAttribute("technical") TechnicalNameBean technicalNameBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("technical", prepareTechnicalNameBean(technicalNameService.getTechnicalName(technicalNameBean.getTechnical_id())));
		return new ModelAndView("technical",model);
	}
	
	@RequestMapping(value="/deleteTechnical", method= RequestMethod.POST)
	public ModelAndView deleteTechnical(@ModelAttribute("technical") TechnicalNameBean technicalNameBean){
		Map<String, Object> model = new HashMap<String, Object>();
		technicalNameService.deleteTechnicalName(technicalNameBean.getTechnical_id());
		model.put("technical", new TechnicalName());
		model.put("technicalList", prepareListTechnical(technicalNameService.listTechnicalNames()));
		return new ModelAndView("technicalList",model);
	}
	
	private Object prepareTechnicalList(List<TechnicalName> listTechnicalNames) {
		Map<Integer,String> technicalList = new LinkedHashMap<Integer,String>();
		for(TechnicalName technicalName:listTechnicalNames)
		{
			technicalList.put(technicalName.getTechnical_id(), technicalName.getTechnical_name());
		}
		return technicalList;
	}
	
	private TechnicalName prepareTechnicalName(TechnicalNameBean technicalNameBean) {
		TechnicalName technicalName=new TechnicalName();
		technicalName.setTechnical_id(technicalNameBean.getTechnical_id());
		technicalName.setTechnical_name(technicalNameBean.getTechnical_name());
		technicalNameBean.setTechnical_id(null);
		return technicalName;
	}

	private Object prepareCatagoryList(List<Catagory> listCatagory) {
		Map<Integer,String> catagoryList = new LinkedHashMap<Integer,String>();
		for(Catagory catgory:listCatagory)
		{
			catagoryList.put(catgory.getCatagory_id(),catgory.getCatagory_name());
		}
		return catagoryList;
	}
	
	private TechnicalNameBean prepareTechnicalNameBean(TechnicalName technicalName) {
		TechnicalNameBean technicalNameBean=new TechnicalNameBean();
		technicalNameBean.setTechnical_id(technicalName.getTechnical_id());
		technicalNameBean.setTechnical_name(technicalName.getTechnical_name());
		return technicalNameBean;
	}
	
	private Object prepareListTechnical(List<TechnicalName> listTechnicalNames) {
		List<TechnicalNameBean> technicalBeanList=new ArrayList<TechnicalNameBean>();
		for(TechnicalName technicalName:listTechnicalNames)
		{
			TechnicalNameBean technicalBean=new TechnicalNameBean();
			technicalBean.setTechnical_id(technicalName.getTechnical_id());
			technicalBean.setTechnical_name(technicalName.getTechnical_name());
			technicalBeanList.add(technicalBean);
		}
		return technicalBeanList;
	}
	
	private Object preparePackingList(List<Packing> listPacking) {
		Map<Integer,String> packingList = new LinkedHashMap<Integer,String>();
		for(Packing packing:listPacking)
		{
			packingList.put(packing.getPacking_id(), packing.getPacking_name());
		}
		return packingList;
	}
	
	@RequestMapping(value="/catagory", method= RequestMethod.GET)
	public ModelAndView Catagory(@ModelAttribute("catagory") CatagoryBean catagoryBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("catagory", new Catagory());
		return new ModelAndView("catagory",model);
	} 
	
	@RequestMapping(value="/saveCatagory", method= RequestMethod.POST)
	public ModelAndView saveCatagory(@ModelAttribute("catagory") CatagoryBean catagoryBean){
//		Map<String, Object> model = new HashMap<String, Object>();
		Catagory catagory=prepareModel(catagoryBean);
		catagoryService.addCatagory(catagory);
//		model.put("catagory", new Catagory());
//		model.put("catagoryList", prepareListCatagoryBean(catagoryService.listCatagory()));
		return new ModelAndView("redirect:catagory.html");
	} 
	
	@RequestMapping(value="/catagoryList", method= RequestMethod.POST)
	public ModelAndView listCatagory(@ModelAttribute("catagory") CatagoryBean catagoryBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("catagoryList", prepareListCatagoryBean(catagoryService.listCatagory()));
		return new ModelAndView("catagoryList",model);
	} 
	
	@RequestMapping(value="/deleteCatagory", method= RequestMethod.POST)
	public ModelAndView deleteCatagory(@ModelAttribute("catagory") CatagoryBean catagoryBean){
		Map<String, Object> model = new HashMap<String, Object>();
		catagoryService.deleteCatagory(catagoryBean.getCatagory_id());
		model.put("catagoryList", prepareListCatagoryBean(catagoryService.listCatagory()));
		return new ModelAndView("catagoryList",model);
	} 

	@RequestMapping(value="/editCatagory", method= RequestMethod.POST)
	public ModelAndView editCatagory(@ModelAttribute("catagory") CatagoryBean catagoryBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("catagory", PrepareCatagoryBean(catagoryService.getCatagory(catagoryBean.getCatagory_id())));
//		model.put("catagoryList", prepareListCatagory(catagoryService.listCatagory()));
		return new ModelAndView("catagory",model);
	} 
	
	private Catagory PrepareCatagoryBean(Catagory catagory) {
		CatagoryBean catagoryBean=new CatagoryBean();
		catagoryBean.setCatagory_id(catagory.getCatagory_id());
		catagoryBean.setCatagory_name(catagory.getCatagory_name());
		return catagory;
	}

	
	private Object prepareListCatagoryBean(List<Catagory> listCatagory) {
	 	List<CatagoryBean> listCatagoryBean=new ArrayList<CatagoryBean>();
		for(Catagory catagory:listCatagory)
		{
			CatagoryBean catagoryBean=new CatagoryBean();
			catagoryBean.setCatagory_id(catagory.getCatagory_id());
			catagoryBean.setCatagory_name(catagory.getCatagory_name());
			System.out.println(catagory.getCatagory_id()+"id");
			System.out.println(catagory.getCatagory_name()+"name");
			listCatagoryBean.add(catagoryBean);
		}
		return listCatagoryBean;
	}

	private Catagory prepareModel(CatagoryBean catagoryBean) {
		Catagory catagory=new Catagory();
		catagory.setCatagory_id(catagoryBean.getCatagory_id());
		catagory.setCatagory_name(catagoryBean.getCatagory_name());
		return catagory;
	}

	@RequestMapping(value="/accountType", method= RequestMethod.GET)
	public ModelAndView accountType(@ModelAttribute("accountType") AccountTypeBean accountTypeBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("accountType", new AccountType());
		return new ModelAndView("accountType",model);
	} 
	
	@RequestMapping(value="/saveAccountType", method= RequestMethod.POST)
	public ModelAndView saveAccountType(@ModelAttribute("accountType") AccountTypeBean accountTypeBean){
		AccountType accountType=prepareAccountType(accountTypeBean);
		accountTypeService.addAccountType(accountType);
		return new ModelAndView("redirect:accountType.html");
	} 
	
	@RequestMapping(value="/editAccountType", method= RequestMethod.POST)
	public ModelAndView editAccountType(@ModelAttribute("accountType") AccountTypeBean accountTypeBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("accountType", prepareAccountTypeBean(accountTypeService.getAccountType(accountTypeBean.getAccount_type_id())));
		return new ModelAndView("accountType",model);
	} 
	
	@RequestMapping(value="/accountTypeList", method= RequestMethod.POST)
	public ModelAndView accountTypeList(@ModelAttribute("accountType") AccountType accountType){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("accountTypeList", prepareAccountTypeBeanList(accountTypeService.listAccountTypes()));
		return new ModelAndView("accountTypeList",model);
	} 
	
	@RequestMapping(value="/deleteAccountType", method= RequestMethod.POST)
	public ModelAndView deleteAccountType(@ModelAttribute("accountType") AccountTypeBean accountTypeBean){
		Map<String, Object> model = new HashMap<String, Object>();
		accountTypeService.deleteAccountType(accountTypeBean.getAccount_type_id());
		model.put("accountTypeList", prepareAccountTypeBeanList(accountTypeService.listAccountTypes()));
		return new ModelAndView("accountTypeList",model);
	} 
	
	private List<AccountTypeBean> prepareAccountTypeBeanList(List<AccountType> listAccountTypes) {
		List<AccountTypeBean> accountTypeBeanList=null;
		if(listAccountTypes != null && !listAccountTypes.isEmpty())
		{
			accountTypeBeanList=new ArrayList<AccountTypeBean>();
			for(AccountType accountType:listAccountTypes)
			{
				AccountTypeBean accountTypeBean=new AccountTypeBean();
				accountTypeBean.setAccount_type_id(accountType.getAccount_type_id());
				accountTypeBean.setAccount_type_name(accountType.getAccount_type_name());
				accountTypeBeanList.add(accountTypeBean);
			}
		}
		return accountTypeBeanList;
	}

	private AccountTypeBean prepareAccountTypeBean(AccountType accountType) {
		AccountTypeBean accountTypeBean=new AccountTypeBean();
		accountTypeBean.setAccount_type_id(accountType.getAccount_type_id());
		accountTypeBean.setAccount_type_name(accountType.getAccount_type_name());
		return accountTypeBean;
	}

	private AccountType prepareAccountType(AccountTypeBean accountTypeBean) {
		AccountType accountType=new AccountType();
		accountType.setAccount_type_id(accountTypeBean.getAccount_type_id());
		accountType.setAccount_type_name(accountTypeBean.getAccount_type_name());
		return accountType;
	}

	@RequestMapping(value="/district", method= RequestMethod.GET)
	public ModelAndView district(@ModelAttribute("district") DistrictBean districtBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("stateList", prepareStateBeanListL(stateService.listStates()));
		model.put("district", new District());
		return new ModelAndView("district",model);
	} 
	
	private Object prepareStateBeanListL(List<State> listStates) {
		Map<Integer, String> stateList= new LinkedHashMap<Integer, String>();
		for(State state:listStates)
		{
			stateList.put(state.getState_id(),state.getState_name());
		}
		return stateList;
	}

	/*private Object prepareStateList(List<Catagory> listCatagory) {
		Map<Integer,String> catagoryList = new LinkedHashMap<Integer,String>();
		for(Catagory catgory:listCatagory)
		{
			catagoryList.put(catgory.getCatagory_id(),catgory.getCatagory_name());
		}
		return catagoryList;
	}*/
	
	@RequestMapping(value="/saveDistrict", method= RequestMethod.POST)
	public ModelAndView saveDistrict(@ModelAttribute("district") DistrictBean districtBean){
		District district=prepareDistrict(districtBean);
		districtService.addDistrict(district);
		return new ModelAndView("redirect:district.html");
	} 
	

	@RequestMapping(value="/districtList", method= RequestMethod.POST)
	public ModelAndView districtList(@ModelAttribute("district") DistrictBean districtBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("districtList", prepareDistrictListBean(districtService.listDistricts()));
		return new ModelAndView("districtList",model);
	} 
	
	@RequestMapping(value="/deleteDistrict", method= RequestMethod.POST)
	public ModelAndView deleteDistrict(@ModelAttribute("district") DistrictBean districtBean){
		districtService.deleteDistrict(districtBean.getDistrict_id());
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("districtList", prepareDistrictListBean(districtService.listDistricts()));
		return new ModelAndView("districtList",model);
	} 
	
	@RequestMapping(value="/editDistrict", method= RequestMethod.POST)
	public ModelAndView editDistrict(@ModelAttribute("district") DistrictBean districtBean,BindingResult result, Model model1){
		//model.put("stateList", prepareStateBeanListKey(stateService.listStates()));
//		model.put("district", prepareDistrictListBean(districtService.getDistrict(districtBean.getDistrict_id())));
		model1.addAttribute("stateList", prepareStateBeanListKey(stateService.listStates()));
		model1.addAttribute("district", prepareDistrictListBean(districtService.getDistrict(districtBean.getDistrict_id())));
		return new ModelAndView("district");
	} 
	
	private Object prepareStateBeanListKey(List<State> listStates) {
		Map<Integer,String> stateList = new LinkedHashMap<Integer,String>();
		for(State state:listStates)
		{
		   stateList.put(state.getState_id(), state.getState_name());	
		}
		return stateList;
	}

	private DistrictBean prepareDistrictListBean(District district) {
		DistrictBean districtBean=new DistrictBean();
		districtBean.setState_id(district.getState_id());
		System.out.println("state Id is: "+district.getState_id());
		districtBean.setDistrict_id(district.getDistrict_id());
		districtBean.setDistrict_name(district.getDistrict_name());
	    return districtBean;
	}

	private List<DistrictBean> prepareDistrictListBean(List<District> listDistricts) {
		List<DistrictBean> districtBeanList=new ArrayList<DistrictBean>();
		for(District district:listDistricts)
		{
			DistrictBean districtBean=new DistrictBean();
			districtBean.setDistrict_id(district.getDistrict_id());
			districtBean.setDistrict_name(district.getDistrict_name());
			districtBean.setState_id(district.getState_id());
			districtBeanList.add(districtBean);
		}
		return districtBeanList;
	}

	private District prepareDistrict(DistrictBean districtBean) {
		District district=new District();
		district.setDistrict_id(districtBean.getDistrict_id());
		district.setDistrict_name(districtBean.getDistrict_name());
		district.setState_id(districtBean.getState_id());
		return district;
	}
	
	@RequestMapping(value="/state", method= RequestMethod.GET)
	public ModelAndView state(@ModelAttribute("state") StateBean stateBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("state", new State());
		return new ModelAndView("state",model);
	} 
	
	@RequestMapping(value="/saveState", method= RequestMethod.POST)
	public ModelAndView saveState(@ModelAttribute("state") StateBean stateBean){
		State state=prepareState(stateBean);
		stateService.addState(state);
		return new ModelAndView("redirect:state.html");
	} 
	
	@RequestMapping(value="/editState", method= RequestMethod.POST)
	public ModelAndView editState(@ModelAttribute("state") StateBean stateBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("state", prepareStateBean(stateService.getState(stateBean.getState_id())));
		return new ModelAndView("state",model);
	} 
	
	@RequestMapping(value="/deleteState", method= RequestMethod.POST)
	public ModelAndView deleteState(@ModelAttribute("state") StateBean stateBean){
		Map<String, Object> model = new HashMap<String, Object>();
		stateService.deleteState(stateBean.getState_id());
		model.put("stateList", prepareStateBeanList(stateService.listStates()));
		return new ModelAndView("stateList",model);
	} 
	
	@RequestMapping(value="/stateList", method= RequestMethod.POST)
	public ModelAndView stateList(@ModelAttribute("state") StateBean stateBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("stateList", prepareStateBeanList(stateService.listStates()));
		return new ModelAndView("stateList",model);
	} 
	
	private List<StateBean> prepareStateBeanList(List<State> listStates) {
		List<StateBean> stateBeanList=new ArrayList<StateBean>();
		for(State state:listStates)
		{
			StateBean stateBean=new StateBean();
			stateBean.setState_id(state.getState_id());
			stateBean.setState_name(state.getState_name());
			stateBeanList.add(stateBean);
		}
		return stateBeanList;
	}

	private StateBean prepareStateBean(State state) {
		StateBean stateBean=new StateBean();
		stateBean.setState_id(state.getState_id());
		stateBean.setState_name(state.getState_name());
		return stateBean;
	}

	private State prepareState(StateBean stateBean) {
		State state=new State();
		state.setState_id(stateBean.getState_id());
		state.setState_name(stateBean.getState_name());
		return state;
	}
	

	@RequestMapping(value="/routeCode", method= RequestMethod.GET)
	public ModelAndView routeCode(@ModelAttribute("routeCode") RouteCodeBean routeCodeBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("routeCode", new RouteCode());
		return new ModelAndView("routeCode",model);
	} 
	
	@RequestMapping(value="/saveRouteCode", method= RequestMethod.POST)
	public ModelAndView saveRouteCode(@ModelAttribute("routeCode") RouteCodeBean routeCodeBean,
			BindingResult result){
		System.out.println("route code Id: "+routeCodeBean.getRoute_code_id());
		System.out.println("Route Code Name: "+routeCodeBean.getRoute_code_name());
		RouteCode routeCode=new RouteCode();
		routeCode.setRoute_code_id(routeCodeBean.getRoute_code_id());
		routeCode.setRoute_code_name(routeCodeBean.getRoute_code_name());
		System.out.println("Rote code from route: "+routeCode.getRoute_code_name());
		routeCodeService.addRouteCode(routeCode);
		return new ModelAndView("redirect:routeCode.html");
	} 

	@RequestMapping(value="/editRouteCode", method= RequestMethod.POST)
	public ModelAndView editRouteCode(@ModelAttribute("routeCode") RouteCodeBean routeCodeBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("routeCode", prepareRouteCodeBean(routeCodeService.getRouteCode(routeCodeBean.getRoute_code_id())));
		return new ModelAndView("routeCode",model);
	} 
	
	@RequestMapping(value="/deleteRouteCode", method= RequestMethod.POST)
	public ModelAndView deleteRouteCode(@ModelAttribute("routeCode") RouteCodeBean routeCodeBean){
		routeCodeService.deleteRouteCode(routeCodeBean.getRoute_code_id());
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("routeCodeList", prepareRouteCodeBeanList(routeCodeService.listRouteCodes()));
		return new ModelAndView("routeCodeList",model);
	} 
	
	@RequestMapping(value="/routeCodeList", method= RequestMethod.POST)
	public ModelAndView routeCodeList(@ModelAttribute("routeCode") RouteCodeBean routeCodeBean){
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("routeCodeList", prepareRouteCodeBeanList(routeCodeService.listRouteCodes()));
		return new ModelAndView("routeCodeList",model);
	} 
	
	private List<RouteCodeBean> prepareRouteCodeBeanList(List<RouteCode> listRouteCodes) {
		List<RouteCodeBean> routeCodeBeanList=new ArrayList<RouteCodeBean>();
		for(RouteCode routeCode:listRouteCodes)
		{
			RouteCodeBean routeCodeBean=new RouteCodeBean();
			routeCodeBean.setRoute_code_id(routeCode.getRoute_code_id());
			routeCodeBean.setRoute_code_name(routeCode.getRoute_code_name());
			routeCodeBeanList.add(routeCodeBean);
		}
		return routeCodeBeanList;
	}

	private RouteCodeBean prepareRouteCodeBean(RouteCode routeCode) {
		RouteCodeBean routeCodeBean=new RouteCodeBean();
		routeCodeBean.setRoute_code_id(routeCode.getRoute_code_id());
		routeCodeBean.setRoute_code_name(routeCode.getRoute_code_name());
		return routeCodeBean;
	}


	@RequestMapping(value = "/index", method = RequestMethod.GET)
	public ModelAndView welcome() {
		return new ModelAndView("index");
	}
	
	@RequestMapping(value="/saveProductInformation", method= RequestMethod.POST)
	public ModelAndView saveProductInformationMaster(@ModelAttribute("productInformation") ProductBean productBean,
			BindingResult result,Model model){
     Product product=prepareModel(productBean);
     productService.addProduct(product);
	 return new ModelAndView("redirect:productInformationMaster.html");
	}
	
	@RequestMapping(value="/productList", method = RequestMethod.POST)
	public ModelAndView listProducts() {
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("productList",  prepareListofBean(productService.listProducts()));
		return new ModelAndView("productList", model);
	}
	
	@RequestMapping(value="/editProduct", method = RequestMethod.POST)
	public ModelAndView editProduct(@ModelAttribute("productInformation") ProductBean productBean,
			BindingResult result,Model model1) {
		System.out.println("The value of Id form Edit Product:"+productBean.getProduct_id());
		Map<String, Object> model = new HashMap<String, Object>();
		/*
		Map<String,String> packing = new LinkedHashMap<String,String>();
		packing.put("1", "100gms");
		packing.put("2", "250gms");
		packing.put("3", "500gms");
		packing.put("4", "1Kg");
		model.put("packingList",packing);
		
		Map<String,String> technicalName = new LinkedHashMap<String,String>();
		technicalName.put("1", "SFate");
		technicalName.put("2", "AWCEPHATE");
		technicalName.put("3", "NEWQWQ");
        model.put("technicalList", technicalName);		
		
        Map<String,String> catagory = new LinkedHashMap<String,String>();
        catagory.put("1", "Catagory A");
        catagory.put("2", "Catagory B");
        catagory.put("3", "Catagory C");
        model.put("catagoryList", catagory);
        */
		model.put("packingList", preparePackingList(packingService.listPacking()));
		model.put("technicalList", prepareTechnicalList(technicalNameService.listTechnicalNames()));
		model.put("catagoryList", prepareCatagoryList(catagoryService.listCatagory()));
		model.put("product",  prepareProductBean(productService.getProduct(productBean.getProduct_id())));
		return new ModelAndView("productInformationMaster",model);
	}
	
	@RequestMapping(value="/deleteProduct", method = RequestMethod.POST)
	public ModelAndView deleteProduct(@RequestParam("id") String product_id) {
		System.out.println("The value of Id"+product_id);
		productService.deleteProduct(Integer.parseInt(product_id));
		Map<String, Object> model = new HashMap<String, Object>();
		model.put("productList",  prepareListofBean(productService.listProducts()));
		return new ModelAndView("productList",model);
	}
	
	private Object prepareProductBean(Product product) {
		ProductBean productBean=new ProductBean();
    	productBean.setProduct_code(product.getProduct_code());
    	productBean.setProduct_name(product.getProduct_name());
    	productBean.setPacking_id(product.getPacking_id());
    	productBean.setCatagory_id(product.getCatagory_id());
    	productBean.setTechnical_id(product.getTechnical_id());
    	productBean.setCompany_code(product.getCompany_code());
    	productBean.setQuantity_on_hand(product.getQuantity_on_hand());
    	productBean.setPurchase_rate(product.getPurchase_rate());
    	productBean.setSale_rate(product.getSale_rate());
    	productBean.setMrp(product.getMrp());
    	productBean.setVat(product.getVat());
    	productBean.setProduct_id(product.getProduct_id());
    	System.out.println("product_id"+product.getProduct_id());
		return productBean;
	}
	
	private Object prepareListofBean(List<Product> listProducts) {
		List<ProductBean> productBeanList=null;
		if(listProducts != null && !listProducts.isEmpty())
		{
			productBeanList=new ArrayList<ProductBean>();
	        ProductBean productBean=null;
	        for(Product product:listProducts)
	        {
	        	productBean=new ProductBean();
	        	productBean.setProduct_id(product.getProduct_id());
	        	productBean.setProduct_code(product.getProduct_code());
	        	productBean.setProduct_name(product.getProduct_name());
	        	productBean.setPacking_id(product.getPacking_id());
	        	productBean.setCatagory_id(product.getCatagory_id());
	        	productBean.setTechnical_id(product.getTechnical_id());
	        	productBean.setCompany_code(product.getCompany_code());
	        	productBean.setQuantity_on_hand(product.getQuantity_on_hand());
	        	productBean.setPurchase_rate(product.getPurchase_rate());
	        	productBean.setSale_rate(product.getSale_rate());
	        	productBean.setMrp(product.getMrp());
	        	productBean.setVat(product.getVat());
	        	productBeanList.add(productBean);
	        }
		}
		return productBeanList;
	}
	private Product prepareModel(ProductBean productBean) {
		Product product=new Product();
		product.setProduct_id(productBean.getProduct_id());
		System.out.println("prepareModel id value:"+productBean.getProduct_id());
		product.setProduct_code(productBean.getProduct_code());
		product.setProduct_name(productBean.getProduct_name());
		product.setPacking_id(productBean.getPacking_id());
		product.setTechnical_id(productBean.getTechnical_id());
		product.setCompany_code(productBean.getCompany_code());
		product.setCatagory_id(productBean.getCatagory_id());
		product.setQuantity_on_hand(productBean.getQuantity_on_hand());
		product.setPurchase_rate(productBean.getPurchase_rate());
		product.setSale_rate(productBean.getSale_rate());
		product.setMrp(productBean.getMrp());
		product.setVat(productBean.getVat());
		productBean.setProduct_id(null);
		return product;
	}
	
	
	@RequestMapping(value="/getDistricts", method = RequestMethod.POST)
	public @ResponseBody void pay(HttpServletRequest request,HttpServletResponse response) throws IOException{
		PrintWriter out=response.getWriter();
		 String state_id=request.getParameter("state_id");
		 Map<Integer,String> districts = new LinkedHashMap<Integer,String>();
		 List<DistrictBean> districtList=prepareDistrictListBean(districtService.listDistricts(Integer.parseInt(state_id)));
		 for(DistrictBean districtBean:districtList)
		 {
			districts.put(districtBean.getDistrict_id(), districtBean.getDistrict_name());
		 }
		 Gson gson = new Gson();
		 String json = gson.toJson(districts);
		 response.setContentType("application/json");
//		 System.out.println(json);
		 out.print(json);
	}
}
